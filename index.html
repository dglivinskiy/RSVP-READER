
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RSVP Reader - RSV1.04a</title>
  <style>
    body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 2rem; background: #f4f4f4; }
    textarea { width: 80%; height: 200px; font-size: 1rem; padding: 0.5rem; margin-bottom: 1rem; }
    #display { font-size: 3rem; margin: 2rem; min-height: 3.5rem; }
    input[type=range] { width: 300px; }
    button { padding: 0.5rem 1rem; margin: 0.3rem; }
  </style>
</head>
<body>
  <h1>RSVP Reader (v1.04a)</h1>
  <textarea id="inputText" placeholder="Paste your text here..."></textarea>
  <div>
    <button onclick="startReading()">Start</button>
    <button onclick="replay()">Replay</button>
    <button onclick="pasteClipboard()">Paste from Clipboard</button>
  </div>
  <p>WPM: <span id="wpmDisplay">300</span></p>
  <input type="range" min="100" max="1000" value="300" step="10" id="wpmSlider" />
  <div id="display"></div>

  <script>
    const display = document.getElementById('display');
    const input = document.getElementById('inputText');
    const slider = document.getElementById('wpmSlider');
    const wpmDisplay = document.getElementById('wpmDisplay');
    let words = [], index = 0, timer;

    slider.oninput = () => {
      wpmDisplay.textContent = slider.value;
    };

    function calculateDelay(word, baseDelay) {
      const punc = word.slice(-1);
      let extra = 0;
      if (punc === ',') extra = 150;
      else if (punc === '.') extra = 300;
      else if (punc === '?' || punc === '!') extra = 350;
      else if (punc === ';' || punc === ':') extra = 200;
      else if (punc === '—' || punc === '–') extra = 250;
      else if (word.endsWith('...')) extra = 400;
      return baseDelay + extra;
    }

    function showWord() {
      if (index >= words.length) return;
      const word = words[index++];
      display.textContent = word;
      const baseDelay = 60000 / parseInt(slider.value);
      const delay = calculateDelay(word, baseDelay);
      timer = setTimeout(showWord, delay);
    }

    function startReading() {
      words = input.value.trim().split(/\s+/);
      index = 0;
      clearTimeout(timer);
      showWord();
    }

    function replay() {
      index = 0;
      clearTimeout(timer);
      showWord();
    }

    async function pasteClipboard() {
      try {
        const text = await navigator.clipboard.readText();
        input.value = text;
      } catch (err) {
        alert("Clipboard access denied.");
      }
    }
  </script>
</body>
</html>
