
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RSVP Reader - RSV1.04b (Calibrate Mode)</title>
  <style>
    body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 2rem; background: #f0f0f0; }
    textarea { width: 80%; height: 150px; font-size: 1rem; margin: 1rem 0; }
    #display { font-size: 2.5rem; margin: 1.5rem 0; min-height: 3rem; }
    button { padding: 0.5rem 1rem; margin: 0.5rem; }
    audio { margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>RSVP Reader v1.04b</h1>
  <p><strong>Calibrate Mode:</strong> Read aloud to personalize your speed</p>

  <textarea id="calibrateText">It is a truth universally acknowledged, that a single man in possession of a good fortune, must be in want of a wife.</textarea>

  <div>
    <button onclick="startRecording()">Start Recording</button>
    <button onclick="stopRecording()">Stop</button>
  </div>

  <audio id="player" controls></audio>

  <script>
    let mediaRecorder, audioChunks = [];

    async function startRecording() {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      audioChunks = [];

      mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
      mediaRecorder.onstop = () => {
        const blob = new Blob(audioChunks, { type: 'audio/webm' });
        const url = URL.createObjectURL(blob);
        document.getElementById('player').src = url;

        // Placeholder: eventually send to processor for timestamp analysis
        console.log("Recording complete. Blob size:", blob.size);
      };

      mediaRecorder.start();
      console.log("Recording started...");
    }

    function stopRecording() {
      if (mediaRecorder && mediaRecorder.state !== "inactive") {
        mediaRecorder.stop();
        console.log("Recording stopped.");
      }
    }
  </script>
</body>
</html>
